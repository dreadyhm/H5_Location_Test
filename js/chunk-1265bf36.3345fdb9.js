(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1265bf36"],{"97b7":function(e,t,i){"use strict";i.d(t,"c",(function(){return r})),i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return l}));var a=i("eeb9"),n=i("2e43");function r(e){return a["a"].post(n["a"].event.list,e)}function s(e){return a["a"].post(n["a"].event.report,e,{timeout:1e4})}function l(e){return a["a"].get(n["a"].event.detail+"/"+e)}},"9bab":function(e,t,i){},b435:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"EventReport"}},[i("van-form",{on:{submit:e.onSubmit}},[i("van-field",{attrs:{label:"事件名称","input-align":"right",placeholder:"请输入",rules:e.rules,clearable:""},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}}),i("van-field",{attrs:{label:"所属网格","input-align":"right",placeholder:"请选择",rules:e.rules,clearable:""},model:{value:e.formData.gridCode,callback:function(t){e.$set(e.formData,"gridCode",t)},expression:"formData.gridCode"}}),i("van-field",{attrs:{label:"紧急程度","input-align":"right",placeholder:"请选择",rules:e.rules,clearable:""},model:{value:e.formData.urgency,callback:function(t){e.$set(e.formData,"urgency",t)},expression:"formData.urgency"}}),i("van-field",{attrs:{label:"事件来源","input-align":"right",placeholder:"请选择",rules:e.rules,clearable:""},model:{value:e.formData.source,callback:function(t){e.$set(e.formData,"source",t)},expression:"formData.source"}}),i("van-field",{attrs:{label:"事件内容","input-align":"right",placeholder:"请输入",rules:e.rules,clearable:""},model:{value:e.formData.content,callback:function(t){e.$set(e.formData,"content",t)},expression:"formData.content"}}),i("van-field",{staticStyle:{display:"block"},attrs:{label:"图片上传"},scopedSlots:e._u([{key:"input",fn:function(){return[i("van-uploader",{model:{value:e.formData.files,callback:function(t){e.$set(e.formData,"files",t)},expression:"formData.files"}})]},proxy:!0}])}),i("div",{staticStyle:{margin:"16px"}},[i("van-button",{attrs:{round:"",block:"",type:"info","native-type":"submit",color:"linear-gradient(180deg, #7FD790, #3FC377)"}},[e._v(" 提交 ")])],1)],1)],1)},n=[],r=i("ade3"),s=(i("68ef"),i("a71a"),i("9d70"),i("3743"),i("09fe"),i("4d75"),i("e3b3"),i("8270"),i("786d"),i("504b"),i("bcd3"),i("c31d")),l=i("d282"),o=i("ea8e"),u=i("a142");function c(e){return Array.isArray(e)?e:[e]}function f(e,t){return new Promise((function(i){if("file"!==t){var a=new FileReader;a.onload=function(e){i(e.target.result)},"dataUrl"===t?a.readAsDataURL(e):"text"===t&&a.readAsText(e)}else i(null)}))}function d(e,t){return c(e).some((function(e){return!!e&&(Object(u["d"])(t)?t(e):e.size>t)}))}var p=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg)/i;function h(e){return p.test(e)}function v(e){return!!e.isImage||(e.file&&e.file.type?0===e.file.type.indexOf("image"):e.url?h(e.url):!!e.content&&0===e.content.indexOf("data:image"))}var m,g={inject:{vanField:{default:null}},watch:{value:function(){var e=this.vanField;e&&(e.resetValidation(),e.validateWithTrigger("onChange"))}},created:function(){var e=this.vanField;e&&!e.children&&(e.children=this)}},b=i("ad06"),w=i("44bf"),y=i("543e"),D=i("28a2"),x=Object(l["a"])("uploader"),S=x[0],$=x[1],k=S({inheritAttrs:!1,mixins:[g],model:{prop:"fileList"},props:{disabled:Boolean,lazyLoad:Boolean,uploadText:String,afterRead:Function,beforeRead:Function,beforeDelete:Function,previewSize:[Number,String],previewOptions:Object,name:{type:[Number,String],default:""},accept:{type:String,default:"image/*"},fileList:{type:Array,default:function(){return[]}},maxSize:{type:[Number,String,Function],default:Number.MAX_VALUE},maxCount:{type:[Number,String],default:Number.MAX_VALUE},deletable:{type:Boolean,default:!0},showUpload:{type:Boolean,default:!0},previewImage:{type:Boolean,default:!0},previewFullImage:{type:Boolean,default:!0},imageFit:{type:String,default:"cover"},resultType:{type:String,default:"dataUrl"},uploadIcon:{type:String,default:"photograph"}},computed:{previewSizeWithUnit:function(){return Object(o["a"])(this.previewSize)},value:function(){return this.fileList}},methods:{getDetail:function(e){return void 0===e&&(e=this.fileList.length),{name:this.name,index:e}},onChange:function(e){var t=this,i=e.target.files;if(!this.disabled&&i.length){if(i=1===i.length?i[0]:[].slice.call(i),this.beforeRead){var a=this.beforeRead(i,this.getDetail());if(!a)return void this.resetInput();if(Object(u["f"])(a))return void a.then((function(e){e?t.readFile(e):t.readFile(i)})).catch(this.resetInput)}this.readFile(i)}},readFile:function(e){var t=this,i=d(e,this.maxSize);if(Array.isArray(e)){var a=this.maxCount-this.fileList.length;e.length>a&&(e=e.slice(0,a)),Promise.all(e.map((function(e){return f(e,t.resultType)}))).then((function(a){var n=e.map((function(e,t){var i={file:e,status:"",message:""};return a[t]&&(i.content=a[t]),i}));t.onAfterRead(n,i)}))}else f(e,this.resultType).then((function(a){var n={file:e,status:"",message:""};a&&(n.content=a),t.onAfterRead(n,i)}))},onAfterRead:function(e,t){var i=this;this.resetInput();var a=e;if(t){var n=e;Array.isArray(e)?(n=[],a=[],e.forEach((function(e){e.file&&(d(e.file,i.maxSize)?n.push(e):a.push(e))}))):a=null,this.$emit("oversize",n,this.getDetail())}var r=Array.isArray(a)?Boolean(a.length):Boolean(a);r&&(this.$emit("input",[].concat(this.fileList,c(a))),this.afterRead&&this.afterRead(a,this.getDetail()))},onDelete:function(e,t){var i,a=this,n=null!=(i=e.beforeDelete)?i:this.beforeDelete;if(n){var r=n(e,this.getDetail(t));if(!r)return;if(Object(u["f"])(r))return void r.then((function(){a.deleteFile(e,t)})).catch(u["h"])}this.deleteFile(e,t)},deleteFile:function(e,t){var i=this.fileList.slice(0);i.splice(t,1),this.$emit("input",i),this.$emit("delete",e,this.getDetail(t))},resetInput:function(){this.$refs.input&&(this.$refs.input.value="")},onPreviewImage:function(e){var t=this;if(this.previewFullImage){var i=this.fileList.filter((function(e){return v(e)})),a=i.map((function(e){return e.content||e.url}));this.imagePreview=Object(D["a"])(Object(s["a"])({images:a,startPosition:i.indexOf(e),onClose:function(){t.$emit("close-preview")}},this.previewOptions))}},closeImagePreview:function(){this.imagePreview&&this.imagePreview.close()},chooseFile:function(){this.disabled||this.$refs.input&&this.$refs.input.click()},genPreviewMask:function(e){var t=this.$createElement,i=e.status,a=e.message;if("uploading"===i||"failed"===i){var n="failed"===i?t(b["a"],{attrs:{name:"close"},class:$("mask-icon")}):t(y["a"],{class:$("loading")}),r=Object(u["c"])(a)&&""!==a;return t("div",{class:$("mask")},[n,r&&t("div",{class:$("mask-message")},[a])])}},genPreviewItem:function(e,t){var i,a,n,r=this,l=this.$createElement,o=null!=(i=e.deletable)?i:this.deletable,u="uploading"!==e.status&&o,c=u&&l("div",{class:$("preview-delete"),on:{click:function(i){i.stopPropagation(),r.onDelete(e,t)}}},[l(b["a"],{attrs:{name:"cross"},class:$("preview-delete-icon")})]),f=this.slots("preview-cover",Object(s["a"])({index:t},e)),d=f&&l("div",{class:$("preview-cover")},[f]),p=null!=(a=e.previewSize)?a:this.previewSize,h=null!=(n=e.imageFit)?n:this.imageFit,m=v(e)?l(w["a"],{attrs:{fit:h,src:e.content||e.url,width:p,height:p,lazyLoad:this.lazyLoad},class:$("preview-image"),on:{click:function(){r.onPreviewImage(e)}}},[d]):l("div",{class:$("file"),style:{width:this.previewSizeWithUnit,height:this.previewSizeWithUnit}},[l(b["a"],{class:$("file-icon"),attrs:{name:"description"}}),l("div",{class:[$("file-name"),"van-ellipsis"]},[e.file?e.file.name:e.url]),d]);return l("div",{class:$("preview"),on:{click:function(){r.$emit("click-preview",e,r.getDetail(t))}}},[m,this.genPreviewMask(e),c])},genPreviewList:function(){if(this.previewImage)return this.fileList.map(this.genPreviewItem)},genUpload:function(){var e=this.$createElement;if(!(this.fileList.length>=this.maxCount)&&this.showUpload){var t,i=this.slots(),a=e("input",{attrs:Object(s["a"])({},this.$attrs,{type:"file",accept:this.accept,disabled:this.disabled}),ref:"input",class:$("input"),on:{change:this.onChange}});if(i)return e("div",{class:$("input-wrapper"),key:"input-wrapper"},[i,a]);if(this.previewSize){var n=this.previewSizeWithUnit;t={width:n,height:n}}return e("div",{class:$("upload"),style:t},[e(b["a"],{attrs:{name:this.uploadIcon},class:$("upload-icon")}),this.uploadText&&e("span",{class:$("upload-text")},[this.uploadText]),a])}}},render:function(){var e=arguments[0];return e("div",{class:$()},[e("div",{class:$("wrapper",{disabled:this.disabled})},[this.genPreviewList(),this.genUpload()])])}}),F=(i("38d5"),i("772a")),O=(i("be7f"),i("565f")),j=(i("66b9"),i("b650")),A=(i("b0c0"),i("159b"),i("b64b"),i("97b7")),I=i("f3d4"),L={name:"EventReport",components:(m={},Object(r["a"])(m,j["a"].name,j["a"]),Object(r["a"])(m,O["a"].name,O["a"]),Object(r["a"])(m,F["a"].name,F["a"]),Object(r["a"])(m,k.name,k),m),data:function(){return{rules:[{required:!0}],formData:{name:"",gridCode:"",urgency:"",content:"",source:"",files:[]}}},created:function(){I["a"].reSetNavBar(),I["a"].setTitle("异常上报")},methods:{onSubmit:function(){var e=this,t=new FormData;Object.keys(this.formData).forEach((function(i){"files"==i?e.formData[i].forEach((function(e){t.append(i,e.file)})):t.append(i,e.formData[i])})),t.append("inspectionId",this.$route.query.visitId),t.append("longitude",this.$route.query.lon),t.append("latitude",this.$route.query.lat),Object(A["a"])(t).then((function(t){t.success&&(e.$toast.success(t.msg),e.$router.back())}))}}},z=L,P=(i("c6bb"),i("2877")),R=Object(P["a"])(z,a,n,!1,null,"af77e99c",null);t["default"]=R.exports},bcd3:function(e,t,i){},c6bb:function(e,t,i){"use strict";i("9bab")}}]);